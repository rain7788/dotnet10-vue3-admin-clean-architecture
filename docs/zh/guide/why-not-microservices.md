# ä¸ºä»€ä¹ˆä¸ç”¨å¾®æœåŠ¡ï¼Ÿ

Art Admin é‡‡ç”¨**æ¨¡å—åŒ–å•ä½“æ¶æ„**ï¼Œè€Œéå¾®æœåŠ¡ã€‚æœ¬æ–‡è§£é‡Šè¿™ä¸ªå†³ç­–èƒŒåçš„è€ƒé‡ï¼Œä»¥åŠå¦‚æœä½ ç¡®å®éœ€è¦å¾®æœåŠ¡æ—¶è¯¥æ€ä¹ˆåšã€‚

## å•ä½“ â‰  æ··ä¹±

å¾ˆå¤šäººå¯¹"å•ä½“"æœ‰è¯¯è§£ï¼Œè®¤ä¸ºå•ä½“å°±æ˜¯ä»£ç å †åœ¨ä¸€èµ·ã€æ— æ³•ç»´æŠ¤ã€‚ä½† Art Admin çš„å•ä½“æ˜¯**æ¨¡å—åŒ–çš„**ï¼š

- å››å±‚æ¸…æ´æ¶æ„ï¼ˆ`Api â†’ Core â†’ Domain â† Infra`ï¼‰ï¼ŒèŒè´£æ¸…æ™°
- ä¸šåŠ¡æŒ‰æ¨¡å—åˆ’åˆ†åœ¨ `Art.Core/Services/` ä¸‹ï¼Œå¤©ç„¶éš”ç¦»
- å¤šç«¯ API éš”ç¦»ï¼ˆAdmin / App / Commonï¼‰ï¼Œäº’ä¸å¹²æ‰°

## ä¸ºä»€ä¹ˆä¸ç”¨å¾®æœåŠ¡ï¼Ÿ

### 1. å¿«é€Ÿå¼€å‘ä¼˜å…ˆ

æœ¬æ¡†æ¶çš„è®¾è®¡ç›®æ ‡æ˜¯**å¿«é€Ÿæ„å»ºåº”ç”¨**ã€‚åœ¨ä¸šåŠ¡çˆ†å‘å‰ï¼Œå•ä½“æ¶æ„èƒ½æ˜¾è‘—é™ä½å¼€å‘å’Œè¿ç»´å¤æ‚åº¦ï¼š

| ç»´åº¦ | å•ä½“ | å¾®æœåŠ¡ |
| --- | --- | --- |
| å¼€å‘è°ƒè¯• | ä¸€ä¸ªè¿›ç¨‹ï¼ŒF5 å¯åŠ¨ | å¤šä¸ªæœåŠ¡ï¼Œéœ€è¦ç¼–æ’ |
| æ•°æ®ä¸€è‡´æ€§ | æœ¬åœ°äº‹åŠ¡ | åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆSaga / TCCï¼‰ |
| éƒ¨ç½²è¿ç»´ | ä¸€ä¸ªå®¹å™¨ | N ä¸ªå®¹å™¨ + æœåŠ¡å‘ç° + ç½‘å…³ |
| å›¢é˜Ÿè¦æ±‚ | 1-5 äººå³å¯ | é€šå¸¸éœ€è¦ DevOps å›¢é˜Ÿ |

### 2. å¤šç«¯é‰´æƒå·²å†…ç½®

å·²æ”¯æŒç®¡ç†ç«¯ã€åº”ç”¨ç«¯ã€å…¬å…±ç«¯ä¸‰å¥—ç‹¬ç«‹ API å’Œè®¤è¯ä½“ç³»ï¼Œæ»¡è¶³ç»å¤§å¤šæ•°ä¸šåŠ¡åœºæ™¯ã€‚ä¸éœ€è¦æ‹†æœåŠ¡æ¥å®ç°å¤šç«¯éš”ç¦»ã€‚

### 3. æ¸…æ´æ¶æ„æ˜“æ‹†åˆ†

å››å±‚åˆ†ç¦»è®¾è®¡ä½¿å¾—æœªæ¥æ‹†åˆ†å¾®æœåŠ¡æˆæœ¬æä½ï¼š

```
Art.Core/Services/
â”œâ”€â”€ Admin/
â”‚   â”œâ”€â”€ UserService.cs          â†’ æ‹†æˆ User å¾®æœåŠ¡
â”‚   â”œâ”€â”€ OrderService.cs         â†’ æ‹†æˆ Order å¾®æœåŠ¡
â”‚   â””â”€â”€ ProductService.cs       â†’ æ‹†æˆ Product å¾®æœåŠ¡
â””â”€â”€ App/
    â””â”€â”€ AppOrderService.cs      â†’ åˆå¹¶åˆ° Order å¾®æœåŠ¡
```

åªéœ€æŒ‰ Domain è¾¹ç•Œæ‹†åˆ†ï¼Œæ¯ä¸ªæœåŠ¡ç‹¬ç«‹éƒ¨ç½²ï¼Œå…±äº« `Domain` å’Œ `Infra` å±‚å³å¯ã€‚

### 4. é¿å…è¿‡æ—©ä¼˜åŒ–

åœ¨ä¸šåŠ¡éªŒè¯é˜¶æ®µï¼Œå¾®æœåŠ¡å¸¦æ¥çš„é—®é¢˜å¾€å¾€å¤§äºæ”¶ç›Šï¼š

- **ç½‘ç»œå»¶è¿Ÿ** â€” æœåŠ¡é—´è°ƒç”¨å¢åŠ  1-10ms å»¶è¿Ÿ
- **åˆ†å¸ƒå¼äº‹åŠ¡** â€” å®ç° Saga æ¨¡å¼ä»£ä»·é«˜æ˜‚
- **è¿ç»´æˆæœ¬** â€” æœåŠ¡å‘ç°ã€é“¾è·¯è¿½è¸ªã€æ—¥å¿—èšåˆã€é…ç½®ä¸­å¿ƒ
- **è°ƒè¯•å›°éš¾** â€” é—®é¢˜å¯èƒ½æ¨ªè·¨å¤šä¸ªæœåŠ¡ï¼Œæ’æŸ¥å¤æ‚

> ğŸ’¡ è¿‡æ—©å¼•å…¥å¾®æœåŠ¡æ˜¯æœ€å¸¸è§çš„æ¶æ„é”™è¯¯ä¹‹ä¸€ã€‚å…ˆç”¨å•ä½“å¿«é€ŸéªŒè¯ä¸šåŠ¡ï¼Œç­‰æµé‡å’Œå›¢é˜Ÿè§„æ¨¡çœŸæ­£éœ€è¦æ—¶å†æ‹†åˆ†ã€‚

## å¦‚æœç¡®å®éœ€è¦å¾®æœåŠ¡

å½“ä½ çš„ä¸šåŠ¡è§„æ¨¡ç¡®å®éœ€è¦å¾®æœåŠ¡æ—¶ï¼ŒArt Admin çš„æ¸…æ´æ¶æ„èƒ½è®©ä½ ä½æˆæœ¬è¿ç§»ã€‚ä»¥ä¸‹æ˜¯æ¨èæ–¹æ¡ˆï¼š

### API ç½‘å…³é€‰æ‹©

| ç½‘å…³ | æ¨èåº¦ | è¯´æ˜ |
| --- | --- | --- |
| **YARP** | â­â­â­â­â­ | å¾®è½¯å®˜æ–¹å‡ºå“ï¼Œè½»é‡é«˜æ€§èƒ½ï¼Œ.NET åŸç”Ÿï¼Œé…ç½®ç®€å• |
| **Ocelot** | â­â­â­â­ | .NET ç”Ÿæ€æˆç†Ÿæ–¹æ¡ˆï¼ŒåŠŸèƒ½ä¸°å¯Œï¼Œç¤¾åŒºæ´»è·ƒ |
| Nginx | â­â­â­ | é€šç”¨æ–¹æ¡ˆï¼Œéœ€è¦é¢å¤–ç»´æŠ¤é…ç½® |
| Kong / APISIX | â­â­ | åŠŸèƒ½å¼ºå¤§ä½†å¼•å…¥é¢å¤–æŠ€æœ¯æ ˆ |

::: tip æ¨è YARP
å¦‚æœè¿½æ±‚**è½»é‡å’Œé«˜æ€§èƒ½**ï¼Œé¦–é€‰ [YARP](https://github.com/microsoft/reverse-proxy)ï¼ˆYet Another Reverse Proxyï¼‰ã€‚å®ƒæ˜¯å¾®è½¯å®˜æ–¹ç»´æŠ¤çš„ .NET åå‘ä»£ç†åº“ï¼Œç›´æ¥é›†æˆåˆ° ASP.NET Core ä¸­ï¼Œæ— éœ€é¢å¤–è¿›ç¨‹ã€‚

```csharp
// YARP ç½‘å…³é…ç½®ç¤ºä¾‹
builder.Services.AddReverseProxy()
    .LoadFromConfig(builder.Configuration.GetSection("ReverseProxy"));

app.MapReverseProxy();
```

```json
{
  "ReverseProxy": {
    "Routes": {
      "user-route": {
        "ClusterId": "user-cluster",
        "Match": { "Path": "/api/user/{**catch-all}" }
      },
      "order-route": {
        "ClusterId": "order-cluster",
        "Match": { "Path": "/api/order/{**catch-all}" }
      }
    },
    "Clusters": {
      "user-cluster": {
        "Destinations": {
          "destination1": { "Address": "http://user-service:8080" }
        }
      },
      "order-cluster": {
        "Destinations": {
          "destination1": { "Address": "http://order-service:8080" }
        }
      }
    }
  }
}
```
:::

å¦‚æœéœ€è¦**æ›´ä¸°å¯Œçš„åŠŸèƒ½**ï¼ˆé™æµã€ç†”æ–­ã€è®¤è¯ç­‰å¼€ç®±å³ç”¨ï¼‰ï¼Œå¯ä»¥é€‰æ‹© [Ocelot](https://github.com/ThreeMammals/Ocelot)ï¼š

```json
{
  "Routes": [
    {
      "DownstreamPathTemplate": "/api/user/{everything}",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [
        { "Host": "user-service", "Port": 8080 }
      ],
      "UpstreamPathTemplate": "/api/user/{everything}",
      "UpstreamHttpMethod": [ "Get", "Post", "Put", "Delete" ]
    }
  ]
}
```

### æ‹†åˆ†æ­¥éª¤

1. **è¯†åˆ«è¾¹ç•Œ** â€” æŒ‰ `Art.Core/Services/` ä¸‹çš„æ¨¡å—åˆ’åˆ†æœåŠ¡è¾¹ç•Œ
2. **ç‹¬ç«‹æ•°æ®åº“** â€” æ¯ä¸ªæœåŠ¡æ‹¥æœ‰è‡ªå·±çš„æ•°æ®åº“ Schema
3. **å¼•å…¥ç½‘å…³** â€” ä½¿ç”¨ YARP æˆ– Ocelot ç»Ÿä¸€å…¥å£
4. **å¼‚æ­¥é€šä¿¡** â€” æœåŠ¡é—´ç”¨æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦ï¼ˆå·²æœ‰ Redis MQ åŸºç¡€è®¾æ–½ï¼‰
5. **é€æ­¥è¿ç§»** â€” ä¸€æ¬¡æ‹†ä¸€ä¸ªæ¨¡å—ï¼Œè€Œéä¸€æ¬¡æ€§é‡æ„

::: warning æé†’
æ‹†åˆ†å¾®æœåŠ¡æ˜¯ä¸€ä¸ªæ¸è¿›è¿‡ç¨‹ï¼Œä¸è¦è¯•å›¾ä¸€æ­¥åˆ°ä½ã€‚å…ˆæ‹†åˆ†æµé‡æœ€å¤§æˆ–å˜æ›´æœ€é¢‘ç¹çš„æ¨¡å—ï¼Œå…¶ä½™ä¿æŒå•ä½“ã€‚
:::
